[from-pstn]

exten => _X.,1,Set(DIDNO=${EXTEN})
exten => _X.,n,Set(CALLER=${CALLERID(num)})
exten => _X.,n,Answer()
exten => _X.,n,Set(time_cond=${ODBC_TIME_COND()})
exten => _X.,n,GotoIf($["${time_cond}"="NOT_MATCH"]?not_match:match)
exten => _X.,n(not_match),Set(CALL_TYPE=INCOMING)
exten => _X.,n,Set(TYPE=${ODBC_CHECK_TYPE_N()})
exten => _X.,n,GotoIf($["${TYPE}"="IVR"]?ivrcontext:queue-check)
exten => _X.,n(ivrcontext),Set(IVRNAME=${ODBC_GETIVRNAME_N()})
exten => _X.,n,CELGenUserEvent(IVRNAME,${IVRNAME})
exten => _X.,n,Set(IVRFILE=${ODBC_GETIVRFILE_N()})
exten => _X.,n,Set(IVRLOOP=${ODBC_GETIVRLOOP_N()})
exten => _X.,n,Set(IVRTIMEOUT=${ODBC_GETIVRTIMEOUT_N()})
exten => _X.,n,Goto(ivr-context,${CALLER},1)
exten => _X.,n(queue-check),GotoIf($["${TYPE}"="QUEUE"]?queue-context:exten-check)
exten => _X.,n(queue-context),Set(QUEUE_VAL=${ODBC_GET_QUEUE_VAL_N()})
exten => _X.,n,Goto(queue-context,${CALLER},1)
exten => _X.,n(exten-check),GotoIf($["${TYPE}"="EXT"]?ext-context:vm-check)
exten => _X.,n(ext-context),Set(EXTEN_VAL=${ODBC_GET_EXTEN_VAL_N()})
exten => _X.,n,Macro(ext,${EXTEN_VAL},${CALLER})
exten => _X.,n(vm-check),GotoIf($["${TYPE}"="VOICEMAIL"]?voicemail:hangup-check)
exten => _X.,n(voicemail),Set(VM_VAL=${ODBC_GET_VM_VAL_N()})
exten => _X.,n,Macro(vm,${VM_VAL},${CALLER})
exten => _X.,n(hangup-check),GotoIf($["${TYPE}"="HANGUP"]?hangup:Playback-check)
exten => _X.,n(hangup),Hangup()
exten => _X.,n(Playback-check),GotoIf($["${TYPE}"="PLAYBACK"]?Playback:dial-check)
exten => _X.,n(Playback),Set(playback=${ODBC_GET_PLAYBACK()})
exten => _X.,n,Playback(${playback})
exten => _X.,n,Hangup()
exten => _X.,n(dial-check),GotoIf($["${TYPE}"="DIAL"]?dailing:hangup)
exten => _X.,n(dailing),Set(Dialing_No=${ODBC_GETDIALNO_N()})
exten => _X.,n,Set(Dial_Count=${ODBC_GET_DIAL_COUNT()})
exten => _X.,n,GotoIf($["${Dial_Count}"="1"]?dial_one:second)
exten => _X.,n(second),GotoIf($["${Dial_Count}"="2"]?dial_two:third)
exten => _X.,n(third),GotoIf($["${Dial_Count}"="3"]?dial_three:fourth)
exten => _X.,n(fourth),GotoIf($["${Dial_Count}"="4"]?dial_four:fifth)
exten => _X.,n(fifth),GotoIf($["${Dial_Count}"="5"]?dial_five:invalid_dial)
exten => _X.,n(dial_one),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)})
exten => _X.,n(dial_two),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)}&DAHDI/g0/${CUT(Dialing_No,_,2)})
exten => _X.,n(dial_three),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)}&DAHDI/g0/${CUT(Dialing_No,_,2)}&DAHDI/g0/${CUT(Dialing_No,_,3)})
exten => _X.,n(dial_four),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)}&DAHDI/g0/${CUT(Dialing_No,_,2)}&DAHDI/g0/${CUT(Dialing_No,_,3)}&DAHDI/g0/${CUT(Dialing_No,_,4)})
exten => _X.,n(dial_five),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)}&DAHDI/g0/${CUT(Dialing_No,_,2)}&DAHDI/g0/${CUT(Dialing_No,_,3)}&DAHDI/g0/${CUT(Dialing_No,_,4)}&DAHDI/g0/${CUT(Dialing_No,_,5)})
exten => _X.,n(invalid_dial),Playback(invalid)
exten => _X.,n,Hangup()
exten => _X.,n(match),Set(variable=${CURL(http://127.0.0.1/aster-dialer/services/time_script.php?time_condition=${time_cond})})
exten => _X.,n,Macro(TIMECON,${variable},${time_cond})
exten => _X.,n,Hangup()


[macro-TIMECON]

exten => s,1,Set(timecondition=${ARG1})
exten => s,n,Set(DIDNO=${EXTEN})
exten => s,n,Set(time_cond=${ARG2})
exten => s,n,Set(CALL_TYPE=INCOMING)
exten => s,n,GotoIf($["${timecondition}"="No"]?third1:second1)
exten => s,n(second1),GotoIf($["${timecondition}"="Yes"]?third2)
exten => s,n(third1),Set(queryString=false_destination)
exten => s,n,Set(dialcount=does_not_dial_count)
exten => s,n,Set(TYPE=${ODBC_MACRO_CHECK_TYPE1()})
exten => s,n,Goto(no_timecond)
exten => s,n(third2),Set(queryString=true_destination)
exten => s,n,Set(dialcount=dial_count)
exten => s,n,Set(TYPE=${ODBC_MACRO_CHECK_TYPE()})
exten => s,n(no_timecond),GotoIf($["${TYPE}"="IVR"]?ivrcontext:queue-check)
exten => s,n(ivrcontext),Set(IVRNAME=${ODBC_MACRO_GETIVRNAME()})
exten => s,n,CELGenUserEvent(IVRNAME,${IVRNAME})
exten => s,n,Set(IVRFILE=${ODBC_MACRO_GETIVRFILE()})
exten => s,n,Set(IVRLOOP=${ODBC_MACRO_GETIVRLOOP()})
exten => s,n,Set(IVRTIMEOUT=${ODBC_MACRO_GETIVRTIMEOUT()})
exten => s,n,Goto(ivr-context,${CALLER},1)
exten => s,n(queue-check),GotoIf($["${TYPE}"="QUEUE"]?queue-context:exten-check)
exten => s,n(queue-context),Set(QUEUE_VAL=${ODBC_MACRO_GET_QUEUE_VAL()})
exten => s,n,Goto(queue-context,${CALLER},1)
exten => s,n(exten-check),GotoIf($["${TYPE}"="EXT"]?exten-context:terminate-check)
exten => s,n(exten-context),Set(EXTEN_VAL=${ODBC_MACRO_GET_EXTEN_VAL())})
exten => s,n,Verbose(${EXTEN_VAL})
exten => s,n,Macro(ext,${EXTEN_VAL},${CALLER})
exten => s,n(terminate-check),GotoIf($["${TYPE}"="TERMINATE"]?terminate:voicemail-check)
exten => s,n(terminate),Hangup()
exten => s,n(voicemail-check),GotoIf($["${TYPE}"="VOICEMAIL"]?voicemail:Playback-check)
exten => s,n(voicemail),Set(VM_VAL=${ODBC_MACRO_GET_VM_VAL()})
exten => s,n,Macro(vm,${VM_VAL},${CALLER})
exten => s,n(Playback-check),GotoIf($["${TYPE}"="PLAYBACK"]?Playback:timecon-check)
exten => s,n(Playback),Set(playback=${ODBC_MACRO_GET_PLAYBACK()})
exten => s,n,Playback(${playback})
exten => s,n,Hangup()
exten => s,n(timecon-check),GotoIf($["${TYPE}"="TIMECON"]?timecon:dial)
;exten => s,n(timecon),Set(variable=${CURL(http://127.0.0.1/aster-dialer/time_script.php?time_condition=${time_cond})})
exten => s,n(timecon),Set(time_cond1=${ODBC_MACRO_TIME_COND()})
exten => s,n,Set(variable1=${CURL(http://127.0.0.1/aster-dialer/time_script.php?time_condition=${time_cond1})})
;exten => s,n,GotoIf($["${variable1}"="No"]?third2:second2)
;exten => s,n(second2),GotoIf($["${variable1}"="Yes"]?third2)
exten => s,n,Macro(TIMECON,${variable1},${time_cond1})
exten => s,n,Hangup()
exten => s,n(dial),GotoIf($["${TYPE}"="DIAL"]?dailing:hangup)
exten => s,n(dailing),Set(Dialing_No=${ODBC_MACRO_GETDIALNO()})
exten => s,n,Set(Dial_Count=${ODBC_MACRO_GET_DIAL_COUNT()})
exten => s,n,GotoIf($["${Dial_Count}"="1"]?dial_one:second)
exten => s,n(second),GotoIf($["${Dial_Count}"="2"]?dial_two:third)
exten => s,n(third),GotoIf($["${Dial_Count}"="3"]?dial_three:fourth)
exten => s,n(fourth),GotoIf($["${Dial_Count}"="4"]?dial_four:fifth)
exten => s,n(fifth),GotoIf($["${Dial_Count}"="5"]?dial_five:invalid_dial)
exten => s,n(dial_one),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)})
exten => s,n(dial_two),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)}&DAHDI/g0/${CUT(Dialing_No,_,2)})
exten => s,n(dial_three),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)}&DAHDI/g0/${CUT(Dialing_No,_,2)}&DAHDI/g0/${CUT(Dialing_No,_,3)})
exten => s,n(dial_four),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)}&DAHDI/g0/${CUT(Dialing_No,_,2)}&DAHDI/g0/${CUT(Dialing_No,_,3)}&DAHDI/g0/${CUT(Dialing_No,_,4)})
exten => s,n(dial_five),Dial(DAHDI/g0/${CUT(Dialing_No,_,1)}&DAHDI/g0/${CUT(Dialing_No,_,2)}&DAHDI/g0/${CUT(Dialing_No,_,3)}&DAHDI/g0/${CUT(Dialing_No,_,4)}&DAHDI/g0/${CUT(Dialing_No,_,5)})
exten => s,n(invalid_dial),Playback(invalid)
exten => s,n,Hangup()
exten => s,n(hangup),Hangup()


;############  TESTING  ##############

[tevatel]
exten => _XXXXXXX.,1,CELGenUserEvent(ACTIONID,${UNIQUE})
exten => _XXXXXXX.,2,Dial(SIP/tevateltest/${EXTEN})
exten => _XXXXXXX.,3,Hangup()

[default]

exten => _XXX,1,Dial(SIP/${EXTEN},,Tt)
exten => _XXX,2,Hangup()

exten => _2212X.,1,ConfBridge(${EXTEN})
exten => _2212X.,2,Hangup()

;############    TESTING    ##############

exten => _345,1,Answer()
exten => _345,2,Wait(30)
exten => _345,3,Hangup()


[manual-dialer]

exten => _X.,1,CELGenUserEvent(ACTIONID,${UNIQUE})
exten => _X.,2,Dial(SIP/${EXTEN})
exten => _X.,3,Hangup()

[manual-dial]

exten => _X.,1,CELGenUserEvent(ACTIONID,${UNIQUE})
exten => _X.,2,Set(CALLERID(num)=${callerID})
exten => _X.,3,MixMonitor(/var/spool/asterisk/wav/${STRFTIME(${EPOCH},,%Y-%m-%d)}/${UNIQUEID}.wav)
exten => _X.,4,Dial(SIP/${EXTEN},,Tt)
exten => _X.,5,Hangup()
exten => h,1,System(php /usr/share/aster/infoRecord.php ${UNIQUEID})

exten => _XXX,1,CELGenUserEvent(ACTIONID,${UNIQUE})
exten => _XXX,2,Set(CALLERID(num)=${callerID})
exten => _XXX,3,Verbose(${CALLERID(num)})
exten => _XXX,4,CELGenUserEvent(RECORD,${UNIQUEID}.wav)
exten => _XXX,5,MixMonitor(${UNIQUEID}.wav)
exten => _XXX,6,Dial(SIP/${EXTEN},,Tt)
exten => _XXX,7,Hangup()


[conf-dial]
exten => _X.,1,CELGenUserEvent(ACTIONID,${UNIQUE})
exten => _X.,n,MixMonitor(/var/spool/asterisk/wav/${STRFTIME(${EPOCH},,%Y-%m-%d)}/${UNIQUEID}.wav)
;exten => _X.,n,Set(CALLERID(num)=19492692250)
exten => _X.,n,Dial(DAHDI/g0/${EXTEN},,Tt)
exten => _X.,n,Hangup()
exten => h,1,System(php /usr/share/aster/infoRecord.php ${UNIQUEID})


exten => _XXX,1,CELGenUserEvent(ACTIONID,${UNIQUE})
exten => _XXX,2,Verbose(${CALLERID(num)})
exten => _XXX,3,CELGenUserEvent(RECORD,${UNIQUEID}.wav)
exten => _XXX,4,MixMonitor(${UNIQUEID}.wav)
exten => _XXX,5,Dial(SIP/${EXTEN},,Tt)

exten => _XXXX,1,CELGenUserEvent(ACTIONID,${UNIQUE})
exten => _XXXX,2,Verbose(${CALLERID(num)})
exten => _XXXX,3,CELGenUserEvent(RECORD,${UNIQUEID}.wav)
exten => _XXXX,4,MixMonitor(${UNIQUEID}.wav)
exten => _XXXX,5,Dial(SIP/${EXTEN},,Tt)

[dialer]

exten => _XX.,1,CELGenUserEvent(ACTIONID,${UNIQUE})
exten => _XX.,2,CELGenUserEvent(LEADID,${LEAD_ID})
exten => _XX.,3,Dial(SIP/${EXTEN})
exten => _XX.,4,Hangup()

[direct-agent-context]

exten => _X.,1,CELGenUserEvent(CALL_TYPE,${CAMP_TYPE})
exten => _X.,2,Set(CALLERID(num)=${PHONE})
exten => _X.,3,MixMonitor(/var/spool/asterisk/wav/${STRFTIME(${EPOCH},,%Y-%m-%d)}/${UNIQUEID}.wav)
exten => _X.,4,Dial(SIP/${USER_EXTEN})
exten => h,1,System(php /usr/share/aster/infoRecord.php ${UNIQUEID})

[dialer-in]

exten => _X.,1,Set(CALLER=${PHONE})
exten => _X.,2,Set(DIDNO=${EXTEN})
exten => _X.,3,GotoIf($["${CAMP_TYPE}"="POWER"]?powercall:vbcallcheck)
exten => _X.,4(powercall),Goto(direct-agent-context,${USER_EXTEN},1)
exten => _X.,5(vbcallcheck),GotoIf($["${CAMP_TYPE}"="VB"]?vbcall:autocall)
exten => _X.,6(vbcall),CELGenUserEvent(VBLAST,ANSWER)
exten => _X.,7(autocall),Set(CALL_TYPE=AUTO)
exten => _X.,8,Set(DIDNO=${EXTEN})
exten => _X.,9,Set(TYPE=${ODBC_CHECK_EXTEN_VALUE()})
exten => _X.,10,GotoIf($["${TYPE}"="IVR"]?ivrcontext:queue-check)
exten => _X.,11(ivrcontext),Set(IVRNAME=${ODBC_GETIVRNAME_N()})
exten => _X.,12,CELGenUserEvent(IVRNAME,${IVRNAME})
exten => _X.,13,Set(IVRFILE=${ODBC_GETIVRNAME_N()})
exten => _X.,14,Set(IVRLOOP=${ODBC_GETIVRLOOP_N()})
exten => _X.,15,Set(IVRTIMEOUT=${ODBC_GETIVRTIMEOUT_N()})
exten => _X.,16,Goto(dialer-ivr-context,${CALLER},1)
exten => _X.,17(queue-check),GotoIf($["${TYPE}"="QUEUE"]?queue-context:exten-check)
exten => _X.,18(queue-context),Set(QUEUE_VAL=${ODBC_GET_QUEUE_VAL_N()})
exten => _X.,19,Goto(dialer-queue-context,${CALLER},1)
exten => _X.,20(exten-check),Set(EXTEN_VAL=${ODBC_GET_QUEUE_VAL_N()})
exten => _X.,21,Macro(ext,${EXTEN_VAL},${CALLER})

[ivr-context]
exten => _X.,1,Set(LOOP_COUNT=0)
exten => _X.,n,Read(OPTION,${IVRFILE},1)
exten => _X.,n,CELGenUserEvent(OPTION,${OPTION})
exten => _X.,n,Set(DIALOPTION1=${ODBC_CHECKOPTION1_N()})
exten => _X.,n,Macro(${DIALOPTION1})

[dialer-ivr-context]
exten => _X.,1,Set(LOOP_COUNT=0)
exten => _X.,n,Read(OPTION,${IVRFILE},1)
;exten => _X.,n,WaitExten(3)
;exten => _X.,n,GotoIf($["${LOOP_COUNT}"<"${IVRLOOP}"]?flow:loopend)
;exten => _X.,n(loopend),Hangup()
;exten => _X.,n(flow),Set(LOOP_COUNT=$[${LOOP_COUNT}+1])
exten => _X.,n,CELGenUserEvent(OPTION,${OPTION})
exten => _X.,n,Set(DIALOPTION1=${ODBC_CHECKOPTION1_N()})
exten => _X.,n,Macro(dialer${DIALOPTION1})

[queue-context]
exten => _X.,1,Set(MONITOR_FILENAME=/var/spool/asterisk/wav/${STRFTIME(${EPOCH},,%Y-%m-%d)}/${UNIQUEID})
exten => _X.,2,CELGenUserEvent(CALL_TYPE,${CALL_TYPE})
exten => _X.,3,Queue(${QUEUE_VAL},Tt,,30)
exten => _X.,4,Hangup()
exten => h,1,System(php /usr/share/aster/infoRecord.php ${UNIQUEID})


[dialer-queue-context]
exten => _X.,1,Set(MONITOR_FILENAME=/var/spool/asterisk/wav/${STRFTIME(${EPOCH},,%Y-%m-%d)}/${UNIQUEID})
exten => _X.,2,CELGenUserEvent(CALL_TYPE,${CALL_TYPE})
exten => _X.,3,Set(CALLERID(num)=${PHONE})
exten => _X.,4,Queue(${QUEUE_VAL},Tt,,30)
exten => _X.,5,Hangup()
exten => h,1,System(php /usr/share/aster/infoRecord.php ${UNIQUEID})

[vbcontext]
exten => _22102,1,Read(VAL,${AUDIOFILE},1)
exten => _22102,2,CELGenUserEvent(DTMFVAL,${VAL})
exten => _22102,3,Hangup()
exten => h,1,CELGenUserEvent(STATUS,${DIALSTATUS})

[barging]

exten =>_59X.,1,Verbose(2,Listening to live agents)
same => n,Set(ap=${EXTEN}:2)
same => n,Verbose(${ap})
same => n,ChanSpy(SIP/${EXTEN:2},qB)
same => n,Hangup()

[w-barging]
exten =>_59X.,1,Verbose(2,Listening to live agents)
same => n,Set(ap=${EXTEN}:2)
same => n,Verbose(${ap})
same => n,ChanSpy(SIP/${EXTEN:2},bw)
same => n,Hangup()

[listen]
exten =>_59X.,1,Verbose(2,Listening to live agents)
same => n,Set(ap=${EXTEN}:2)
same => n,Verbose(${ap})
same => n,ChanSpy(SIP/${EXTEN:2},q)
same => n,Hangup()



;###############################   TRANSFER    ##################################


[xfer_queue]

exten => _X.,1,Set(ACC_CODE=${EXTEN})
exten => _X.,2,Set(QUEUE_VAL=${ODBC_GET_XFER_QUEUE()})
exten => _X.,3,Queue(${QUEUE_VAL},Tt,,30)
exten => _X.,4,Hangup()

[xfer_exten]

exten => _X.,1,Dial(SIP/${EXTEN},,Tt)
exten => _X.,2,Hangup()


[xfer_phone]

exten => _X.,1,Dial(DAHDI/g0/${EXTEN},,Tt)
exten => _X.,2,Hangup()


;##################################    MACRO   ####################################

[macro-confer]
exten => s,1,Set(CALLER=${ARG1})
exten => s,2,Set(CONFNO=${ARG2})
exten => s,3,GotoIf($["${CONF_FUNCT}" = "OUT"]?conf:validateuser)
exten => s,4(validateuser),Read(PIN,conf-getpin,4)
exten => s,5,Set(PIN=${PIN})
exten => s,6,Set(VALIDATE=${ODBC_VALIDATEPIN()})
exten => s,7,GotoIf($["${VALIDATE}" = "YES"]?conf:abandoncall)
exten => s,8(abandoncall),Playback(conf-invalidpin)
exten => s,9,Hangup()
exten => s,10(conf),CELGenUserEvent(CONFBRIDGE,${CONFNO})
exten => s,11,Set(EXTEN=${CONFNO})
exten => s,12,Confbridge(${CONFNO},default_user_profile,default_bridge_profile,conf_menu)

[macro-ext]
exten => s,1,Set(EXTENVAL=${ARG1})
exten => s,2,Set(CALLER=${ARG2})
exten => s,3,CELGenUserEvent(EXTENVAL,${EXTENVAL})
exten => s,4,Set(EXTENSTATUS=${ODBC_GET_EXTEN_STATUS()})
exten => s,5,GotoIf($["${EXTENSTATUS}"="READY"]?ready:busy)
exten => s,6(busy),Hangup()
exten => s,7(ready),MixMonitor(/var/spool/asterisk/wav/${STRFTIME(${EPOCH},,%Y-%m-%d)}/${UNIQUEID}.wav)
exten => s,8,Dial(SIP/${EXTENVAL},30,Tt)
exten => s,9,Hangup()
exten => h,1,System(php /usr/share/aster/infoRecord.php ${UNIQUEID})


[macro-queue]
exten => s,1,Set(QUEUENAME=${ARG1})
exten => s,2,Set(CALLER=${ARG2})
exten => s,3,CELGenUserEvent(CALL_TYPE,${CALL_TYPE})
exten => s,4,Set(MONITOR_FILENAME=/var/spool/asterisk/wav/${STRFTIME(${EPOCH},,%Y-%m-%d)}/${UNIQUEID})
exten => s,5,Queue(${QUEUENAME},Tt,,30)
exten => h,1,System(php /usr/share/aster/infoRecord.php ${UNIQUEID})

[macro-dialerqueue]
exten => s,1,Set(QUEUENAME=${ARG1})
exten => s,2,Set(CALLER=${ARG2})
exten => s,3,CELGenUserEvent(CALL_TYPE,${CALL_TYPE})
exten => s,4,Set(MONITOR_FILENAME=/var/spool/asterisk/wav/${STRFTIME(${EPOCH},,%Y-%m-%d)}/${UNIQUEID})
exten => s,5,Queue(${QUEUENAME},Tt,,30)
exten => h,1,System(php /usr/share/aster/infoRecord.php ${UNIQUEID})

[macro-ivr]
exten => s,1,Set(IVRNAME=${ARG1})
exten => s,2,Set(CALLER=${ARG2})
exten => s,3,Set(IVRFILE=${ODBC_GETIVRFILE_N()})
exten => s,4,Set(IVRLOOP=${ODBC_GETIVRLOOP_N()})
exten => s,5,Set(LOOP_COUNT=0)
exten => s,6,Read(OPTION,${IVRFILE},1)
exten => s,7,GotoIf($["${LOOP_COUNT}"<"${IVRLOOP}"]?flow:loopend)
exten => s,8(loopend),Hangup()
exten => s,9(flow),Set(LOOP_COUNT=$[${LOOP_COUNT}+1])
exten => s,10,CELGenUserEvent(OPTION,${OPTION})
exten => s,11,Set(DIALOPTION1=${ODBC_CHECKOPTION1_N()})
exten => s,12,Macro(${DIALOPTION1})

[macro-dialerivr]
exten => s,1,Set(IVRNAME=${ARG1})
exten => s,2,Set(CALLER=${ARG2})
exten => s,3,Set(IVRFILE=${ODBC_GETIVRNAME_N()})
exten => s,4,Set(IVRLOOP=${ODBC_GETIVRLOOP_N()})
exten => s,5,Set(LOOP_COUNT=0)
exten => s,6,Read(OPTION,${IVRFILE},1)
exten => s,7,GotoIf($["${LOOP_COUNT}"<"${IVRLOOP}"]?flow:loopend)
exten => s,8(loopend),Hangup()
exten => s,9(flow),Set(LOOP_COUNT=$[${LOOP_COUNT}+1])
exten => s,10,CELGenUserEvent(OPTION,${OPTION})
exten => s,11,Set(DIALOPTION1=${ODBC_CHECKOPTION1_N()})
exten => s,12,Macro(dialer${DIALOPTION1})

[macro-vb]
exten => s,1,CELGenUserEvent(UNIQUE,${UNIQUE})
exten => s,2,CELGenUserEvent(AUDIOFILE,${AUDIOFILE})
exten => s,3,Set(DIALNO=${ARG1})
exten => s,4,CELGenUserEvent(STATUS,${DIALSTATUS})
;exten => s,5,Set(CALLERID(num)=4430143800)
exten => s,5,Dial(SIP/${DIALNO},,Tt)
exten => s,6,Hangup()

[macro-vm]

exten => s,1,Set(VM_VAL=${ARG1})
exten => s,2,Set(CALLER=${ARG2})
exten => s,3,CELGenUserEvent(VM_VAL,${VM_VAL})
exten => s,4,VoiceMail(${VM_VAL})

[macro-time_con]

exten => s,1,Set(TIME_CON_VAL=${ARG1})
exten => s,2,Set(CALLER=${ARG2})
exten => s,3,CELGenUserEvent(TIME_CON_VAL,${TIME_CON_VAL})
exten => s,4,Goto(def,s,1)


;#################################################### VOICE BLAST ##############################################################

[Voice_Record]

exten => _X.,1,Set(CALLER=${CALLERID(num)})
exten => _X.,n,Set(DIDNO=${EXTEN})
exten => _X.,n,Set(FILENAME=${filename})
exten => _X.,n,Set(Lang_Type=${CUT(FILENAME,_,1)})
exten => _X.,n,GotoIf($["${Lang_Type}"="english"]?english:opt2)
exten => _X.,n(opt2),GotoIf($["${Lang_Type}"="telugu"]?telugu:opt3)
exten => _X.,n(opt3),GotoIf($["${Lang_Type}"="tamil"]?tamil:invalid)
exten => _X.,n(invalid),Hangup()
exten => _X.,n(english),Goto(English)
exten => _X.,n(telugu),Goto(Telugu)
exten => _X.,n(tamil),Goto(Tamil)

;//ENGLISH

exten => _X.,n(English),Playback(record_msg)
exten => _X.,n,record(/var/lib/asterisk/sounds/${FILENAME}.wav,,120,k)
exten => _X.,n,Playback(recording_is)
exten => _X.,n,Playback(${FILENAME})
exten => _X.,n,Set(LOOP_COUNT=0)
exten => _X.,n(read1),GotoIf($["${LOOP_COUNT}"<="2"]?flow:loopend)
exten => _X.,n(loopend),Hangup()
exten => _X.,n(flow),Read(DTMF,Your_recording,1,,,5)   ; press 1 for conform & 2 for rerecord
exten => _X.,n,Set(LOOP_COUNT=$[${LOOP_COUNT}+1])
exten => _X.,n,GotoIf($[${LEN(${DTMF})}>0]?test2:comp2)
exten => _X.,n(comp2),Playback(enterednothing)
exten => _X.,n,Goto(read1)
exten => _X.,n(test2),GotoIf($["${DTMF}"="1"]?conform:rerecord)
exten => _X.,n(conform),Playback(recording_saved)
exten => _X.,n,Set(ODBC_VOICE_BLAST()=${FILENAME})
exten => _X.,n,Hangup()
exten => _X.,n(rerecord),GotoIf($["${DTMF}"="2"]?English:invalid1)
exten => _X.,n(invalid1),Playback(invalid_num)
exten => _X.,n,Goto(read1)

;// TELUGU

exten => _X.,n(Telugu),Playback(record_msg)
exten => _X.,n,record(/var/lib/asterisk/sounds/${FILENAME}.wav,,120,k)
exten => _X.,n,Playback(recording_is)
exten => _X.,n,Playback(${FILENAME})
exten => _X.,n,Set(LOOP_COUNT1=0)
exten => _X.,n(read2),GotoIf($["${LOOP_COUNT1}"<="2"]?flow1:loopend1)
exten => _X.,n(loopend1),Hangup()
exten => _X.,n(flow1),Read(DTMF,Your_recording,1,,,5)   ; press 1 for conform & 2 for rerecord
exten => _X.,n,Set(LOOP_COUNT1=$[${LOOP_COUNT1}+1])
exten => _X.,n,GotoIf($[${LEN(${DTMF})}>0]?test3:comp3)
exten => _X.,n(comp3),Playback(enterednothing)
exten => _X.,n,Goto(read2)
exten => _X.,n(test3),GotoIf($["${DTMF}"="1"]?conform1:rerecord1)
exten => _X.,n(conform1),Playback(recording_saved)
exten => _X.,n,Set(ODBC_VOICE_BLAST()=${FILENAME})
exten => _X.,n,Hangup()
exten => _X.,n(rerecord1),GotoIf($["${DTMF}"="2"]?Telugu:invalid2)
exten => _X.,n(invalid2),Playback(invalid_num)
exten => _X.,n,Goto(read2)

;//TAMIL

exten => _X.,n(Tamil),Playback(record_msg)
exten => _X.,n,record(/var/lib/asterisk/sounds/${FILENAME}.wav,,120,k)
exten => _X.,n,Playback(recording_is)
exten => _X.,n,Playback(${FILENAME})
exten => _X.,n,Set(LOOP_COUNT2=0)
exten => _X.,n(read3),GotoIf($["${LOOP_COUNT2}"<="2"]?flow2:loopend2)
exten => _X._X.,n(loopend2),Hangup()
exten => _X.,n(flow2),Read(DTMF,Your_recording,1,,,5)   ; press 1 for conform & 2 for rerecord
exten => _X.,n,Set(LOOP_COUNT2=$[${LOOP_COUNT2}+1])
exten => _X.,n,GotoIf($[${LEN(${DTMF})}>0]?test4:comp4)
exten => _X.,n(comp4),Playback(enterednothing)
exten => _X.,n,Goto(read3)
exten => _X.,n(test4),GotoIf($["${DTMF}"="1"]?conform2:rerecord2)
exten => _X.,n(conform2),Playback(recording_saved)
exten => _X.,n,Set(ODBC_VOICE_BLAST()=${FILENAME})
exten => _X.,n,Hangup()
exten => _X.,n(rerecord2),GotoIf($["${DTMF}"="2"]?Tamil:invalid3)
exten => _X.,n(invalid3),Playback(invalid_num)
exten => _X.,n,Goto(read3)

;[VoiceBlast]

;exten => _X.,1(blast),Playback(${AUDIOFILE})
;exten => _X.,n(hangup),Hangup()

[voiceblast_record]

exten => _X.,1,Set(Dial_no=${phone_number})
exten => _X.,n,Dial(SIP/${Dial_no})


[VoiceBlast]

exten => _X.,1(blast),Set(campaign_name=${campaign})
exten => _X.,n,Set(didno=${CUT(campaign_name,_,2)})
exten => _X.,n,set(campaign_name=${CUT(campaign_name,_,1)})
exten => _X.,n,GotoIf($["${campaign_name}"="BeforeDue"]?beforedue:test1)
exten => _X.,n(test1),GotoIf($["${campaign_name}"="AfterDue"]?afterdue:test2)
exten => _X.,n(test2),GotoIf($["${campaign_name}"="OutgoingBarred"]?callbarred:test3)
exten => _X.,n(test3),GotoIf($["${campaign_name}"="Special"]?special_offer)

exten => _X.,n(beforedue),Set(Type=${ODBC_LANGUAGE_TYPE()})
;exten => _X.,n(beforedue),Set(Type=english)
exten => _X.,n,GotoIf($["${Type}"="english"]?BeforeDue_English:test4)
exten => _X.,n(test4),GotoIf($["${Type}"="telugu"]?BeforeDue_Telugu)
exten => _X.,n(BeforeDue_English),Goto(BeforeDue_English,s,1)
exten => _X.,n(BeforeDue_Telugu),Goto(BeforeDue_Telugu,s,1)

exten => _X.,n(afterdue),Set(Type=${ODBC_LANGUAGE_TYPE()})
;exten => _X.,n(afterdue),Set(Type=english)
exten => _X.,n,GotoIf($["${Type}"="english"]?AfterDue_English:test5)
exten => _X.,n(test5),GotoIf($["${Type}"="telugu"]?AfterDue_Telugu)
exten => _X.,n(AfterDue_English),Goto(AfterDue_English,s,1)
exten => _X.,n(AfterDue_Telugu),Goto(AfterDue_Telugu,s,1)

exten => _X.,n(callbarred),Set(Type=${ODBC_LANGUAGE_TYPE()})
;exten => _X.,n(callbarred),Set(Type=telugu)
exten => _X.,n,GotoIf($["${Type}"="english"]?CallBarred_English:test6)
exten => _X.,n(test6),GotoIf($["${Type}"="telugu"]?CallBarred_Telugu)
exten => _X.,n(CallBarred_English),Goto(CallBarred_English,s,1)
exten => _X.,n(CallBarred_Telugu),Goto(CallBarred_Telugu,s,1)

exten => _X.,n(special_offer),Playback(${AUDIOFILE})
exten => _X.,n(hangup),Hangup()


[BeforeDue_English]

exten => s,1,Playback(before_english_1)
exten => s,n,SayDigits(${amount})
exten => s,n,Playback(before_english_2)
exten => s,n,SayDigits(${due_date})
exten => s,n,Playback(before_english_3)
exten => s,n,Hangup()


[BeforeDue_Telugu]

exten => s,1,Playback(before_telugu_1)
exten => s,n,SayDigits(${amount})
exten => s,n,Playback(before_telugu_2)
exten => s,n,SayDigits(${due_date})
exten => s,n,Playback(before_telugu_3)
exten => s,n,Hangup()


[AfterDue_English]

exten => s,1,Playback(after_english_1)
exten => s,n,Set(phone=${campaign})
exten => s,n,Set(phone_number=${CUT(phone,_,3)})
exten => s,n,SayDigits(${amount})
exten => s,n,Playback(after_english_2)
exten => s,n,SayDigits(${phone_number})
exten => s,n,Playback(after_english_3)
exten => s,n,Hangup()

[AfterDue_Telugu]

exten => s,1,Playback(after_telugu_1)
exten => s,n,SayDigits(${amount})
exten => s,n,Playback(after_telugu_2)
exten => s,n,Hangup()

[CallBarred_English]

exten => s,1,Playback(barred_english_1)
exten => s,n,SayDigits(${amount})
exten => s,n,Playback(barred_english_2)
exten => s,n,Hangup()

[CallBarred_Telugu]

exten => s,1,Playback(barred_telugu_1)
exten => s,n,SayDigits(${amount})
exten => s,n,Playback(barred_telugu_2)
exten => s,n,Hangup()

